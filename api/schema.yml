openapi: 3.0.0
servers:
  - url: http://localhost:8080

info:
  title: Bizon
  version: 1.0.0
  description: Маркетплейс

paths:
  /api/1/users:
    post:
      summary: User registration
      tags: [ Authentication ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignupRequest'
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        '400':
          description: Invalid input

  /api/1/auth:
    get:
      summary: Check authentication status
      tags: [ Authentication ]
      responses:
        '200':
          description: User is authenticated
          content:
            application/json:
              schema:
                type: object
                properties:
                  authenticated:
                    type: boolean
                    example: true
        '401':
          description: User is not authenticated
    delete:
      summary: User logout
      tags: [ Authentication ]
      responses:
        '200':
          description: Successfully logged out
        '401':
          description: Unauthorized
    post:
      summary: User login
      tags: [ Authentication ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Successful login
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        '401':
          description: Invalid credentials

  /api/1/users/{id}:
    get:
      summary: Get user profile
      tags: [User]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
      responses:
        '200':
          description: User profile retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '401':
          description: Unauthorized
        '404':
          description: User not found
    put:
      summary: Update user profile
      tags: [User]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
      responses:
        '200':
          description: User profile updated successfully
        '400':
          description: Invalid input
        '401':
          description: Unauthorized

  /api/1/users/{id}/meta:
    get:
      summary: Get user metadata
      tags: [User]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
      responses:
        '200':
          description: User metadata retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserMetaResponse'
        '401':
          description: Unauthorized

  /api/1/users/{id}/password:
    patch:
      summary: Update user password
      tags: [User]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePasswordRequest'
      responses:
        '200':
          description: Password updated successfully
        '400':
          description: Invalid input
        '401':
          description: Unauthorized

  /api/1/items:
    get:
      summary: Get all items
      tags: [Items]
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            example: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            example: 20
      responses:
        '200':
          description: Items retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ItemsFetchResponse'
        '400':
          description: Invalid query parameters
    post:
      summary: Create a new item
      tags: [Items]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateItemRequest'
      responses:
        '201':
          description: Item created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateItemResponse'
        '400':
          description: Invalid input
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

  /api/1/items/{id}:
    get:
      summary: Get item by ID
      tags: [Items]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
      responses:
        '200':
          description: Item retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Item'
        '404':
          description: Item not found
    put:
      summary: Update item
      tags: [Items]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateItemRequest'
      responses:
        '200':
          description: Item updated successfully
        '400':
          description: Invalid input
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Item not found
    delete:
      summary: Delete item by ID
      tags: [Items]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
      responses:
        '204':
          description: Item deleted successfully
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Item not found

  /api/1/users/{id}/cart/items:
    get:
      summary: Get cart items
      tags: [Cart]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
      responses:
        '200':
          description: Cart items retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetCartItemsResponse'
        '401':
          description: Unauthorized
    post:
      summary: Add item to cart
      tags: [Cart]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddItemRequest'
      responses:
        '200':
          description: Item added to cart successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AddItemResponse'
        '400':
          description: Invalid input
        '401':
          description: Unauthorized
        '404':
          description: Item not found
    delete:
      summary: Clear cart
      tags: [Cart]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
      responses:
        '204':
          description: Cart cleared successfully
        '401':
          description: Unauthorized

  /api/1/users/{userId}/cart/items/{itemId}:
    delete:
      summary: Remove item from cart
      tags: [Cart]
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
        - name: itemId
          in: path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
      responses:
        '200':
          description: Item removed from cart successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteItemResponse'
        '400':
          description: Invalid input
        '401':
          description: Unauthorized
        '404':
          description: Item not found in cart

  /api/1/users/{id}/orders:
    get:
      summary: Get user orders
      tags: [Orders]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
      responses:
        '200':
          description: Orders retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetOrdersResponse'
        '401':
          description: Unauthorized
    post:
      summary: Create order from cart
      tags: [Orders]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateOrderRequest'
      responses:
        '201':
          description: Order created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateOrderResponse'
        '400':
          description: Cart is empty
        '401':
          description: Unauthorized

  /api/1/users/{userId}/orders/{orderId}:
    get:
      summary: Get order by ID
      tags: [Orders]
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
        - name: orderId
          in: path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
      responses:
        '200':
          description: Order retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetOrderResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Order not found
    patch:
      summary: Update order
      tags: [ Orders ]
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
        - name: orderId
          in: path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateOrderRequest'
      responses:
        '200':
          description: Order status updated successfully
        '400':
          description: Invalid status
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Order not found

  /api/1/items/{id}/reviews:
    get:
      summary: Get reviews for item
      tags: [ Reviews ]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
      responses:
        '200':
          description: Reviews retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetReviewsResponse'
        '404':
          description: Item not found
    post:
      summary: Create review
      tags: [Reviews]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateReviewRequest'
      responses:
        '201':
          description: Review created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateReviewResponse'
        '400':
          description: Invalid input
        '401':
          description: Unauthorized

  /api/1/categories/{id}:
    get:
      summary: Get category by ID
      tags: [Categories]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
      responses:
        '200':
          description: Category retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetCategoryResponse'
        '404':
          description: Category not found

  /api/1/categories/{id}/items:
    get:
      summary: Get items by category
      tags: [Categories]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            example: 1
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            example: 20
      responses:
        '200':
          description: Items retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GetItemsByCategoryResponse'
        '404':
          description: Category not found

  /api/1/seller/{id}/items:
    get:
      summary: Get seller's items
      tags: [Seller]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
            minimum: 1
      responses:
        '200':
          description: Seller items retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ItemsFetchResponse'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden

components:
  schemas:
    LoginRequest:
      type: object
      required:
        - login
        - password
      properties:
        login:
          type: string
          example: "user@example.com"
        password:
          type: string
          format: password
          example: "password123"

    SignupRequest:
      type: object
      required:
        - login
        - password
        - role
      properties:
        login:
          type: string
          example: "user@example.com"
        password:
          type: string
          format: password
          example: "password123"
        role:
          type: string
          enum: ["buyer", "seller", "admin"]
          example: "buyer"

    UserResponse:
      type: object
      required:
        - name
        - login
        - phone
        - role
      properties:
        name:
          type: string
          example: "John Doe"
        login:
          type: string
          example: "john@example.com"
        phone:
          type: string
          example: "+1234567890"
        role:
          type: string
          example: "buyer"

    UserMetaResponse:
      type: object
      required:
        - name
        - cartItemsAmount
      properties:
        name:
          type: string
          example: "John Doe"
        cartItemsAmount:
          type: integer
          example: 5

    UpdateUserRequest:
      type: object
      required:
        - name
        - login
        - phone
      properties:
        name:
          type: string
          example: "John Doe Updated"
        login:
          type: string
          example: "john.updated@example.com"
        phone:
          type: string
          example: "+0987654321"

    UpdatePasswordRequest:
      type: object
      required:
        - password
        - newPassword
      properties:
        password:
          type: string
          format: password
          example: "oldpassword123"
        newPassword:
          type: string
          format: password
          example: "newpassword456"

    Item:
      type: object
      required:
        - id
        - name
        - description
        - price
        - rating
        - imgSrc
        - seller
        - amount
      properties:
        id:
          type: integer
          format: int64
          example: 1
        name:
          type: string
          example: "Product Name"
        description:
          type: string
          example: "Product description"
        price:
          type: integer
          example: 9999
        rating:
          type: number
          format: double
          example: 4.5
        imgSrc:
          type: string
          example: "/images/product.jpg"
        seller:
          type: string
          example: "Seller Name"
        amount:
          type: integer
          example: 10

    ItemCard:
      type: object
      required:
        - id
        - name
        - price
        - imgSrc
        - seller
      properties:
        id:
          type: integer
          format: int64
          example: 1
        name:
          type: string
          example: "Product Name"
        price:
          type: integer
          example: 9999
        imgSrc:
          type: string
          example: "/images/product.jpg"
        seller:
          type: string
          example: "Seller Name"
        amount:
          type: integer
          example: 10

    ItemInfo:
      type: object
      required:
        - id
        - name
        - description
        - price
        - imgSrc
        - seller
        - amount
      properties:
        id:
          type: integer
          format: int64
          example: 1
        name:
          type: string
          example: "Product Name"
        description:
          type: string
          example: "Product description"
        price:
          type: integer
          example: 9999
        imgSrc:
          type: string
          example: "/images/product.jpg"
        seller:
          type: object
          required:
            - id
            - name
          properties:
            id:
              type: integer
              format: int64
              example: 1
            name:
              type: string
              example: "Seller Name"
        amount:
          type: integer
          example: 10

    CreateItemRequest:
      type: object
      required:
        - name
        - description
        - price
        - imgSrc
      properties:
        name:
          type: string
          example: "New Product"
        description:
          type: string
          example: "New product description"
        price:
          type: integer
          example: 5000
        imgSrc:
          type: string
          example: "/images/new-product.jpg"

    CreateItemResponse:
      type: object
      required:
        - itemId
      properties:
        itemId:
          type: integer
          format: int64
          example: 123

    UpdateItemRequest:
      type: object
      required:
        - id
        - name
        - description
        - price
        - imgSrc
      properties:
        id:
          type: integer
          format: int64
          example: 1
        name:
          type: string
          example: "Updated Product Name"
        description:
          type: string
          example: "Updated description"
        price:
          type: integer
          example: 7999
        imgSrc:
          type: string
          example: "/images/updated-product.jpg"

    CartItem:
      type: object
      required:
        - id
        - name
        - price
        - count
        - imgSrc
      properties:
        id:
          type: integer
          format: int64
          example: 1
        name:
          type: string
          example: "Product Name"
        price:
          type: integer
          example: 9999
        count:
          type: integer
          example: 2
        imgSrc:
          type: string
          example: "/images/product.jpg"

    GetCartItemsResponse:
      type: object
      required:
        - totalPrice
        - totalCount
        - items
      properties:
        totalPrice:
          type: integer
          example: 19998
        totalCount:
          type: integer
          example: 2
        items:
          type: array
          items:
            $ref: '#/components/schemas/CartItem'

    AddItemRequest:
      type: object
      required:
        - itemId
      properties:
        itemId:
          type: integer
          format: int64
          example: 1

    AddItemResponse:
      type: object
      required:
        - count
      properties:
        count:
          type: integer
          example: 3

    DeleteItemResponse:
      type: object
      required:
        - count
      properties:
        count:
          type: integer
          example: 2

    OrderInfo:
      type: object
      required:
        - id
        - buyerId
        - itemsCount
        - status
        - createdAt
      properties:
        id:
          type: integer
          format: int64
          example: 1
        buyerId:
          type: integer
          format: int64
          example: 1
        itemsCount:
          type: integer
          example: 3
        status:
          type: string
          example: "processing"
        createdAt:
          type: string
          format: date-time
          example: "2023-12-01T10:00:00Z"

    OrderItemInfo:
      type: object
      required:
        - id
        - name
        - price
        - count
        - imgSrc
      properties:
        id:
          type: integer
          format: int64
          example: 1
        name:
          type: string
          example: "Product Name"
        price:
          type: integer
          example: 9999
        count:
          type: integer
          example: 2
        imgSrc:
          type: string
          example: "/images/product.jpg"

    GetOrderResponse:
      type: object
      required:
        - id
        - buyerId
        - itemsCount
        - status
        - createdAt
        - sum
        - items
      properties:
        id:
          type: integer
          format: int64
          example: 1
        buyerId:
          type: integer
          format: int64
          example: 1
        itemsCount:
          type: integer
          example: 3
        status:
          type: string
          example: "processing"
        createdAt:
          type: string
          format: date-time
          example: "2023-12-01T10:00:00Z"
        sum:
          type: integer
          example: 29997
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItemInfo'

    GetOrdersResponse:
      type: object
      required:
        - orders
      properties:
        orders:
          type: array
          items:
            $ref: '#/components/schemas/OrderInfo'

    CreateOrderResponse:
      type: object
      required:
        - orderID
      properties:
        orderID:
          type: integer
          format: int64
          example: 123

    UpdateOrderRequest:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          example: "created"

    ReviewInfo:
      type: object
      required:
        - id
        - userId
        - userName
        - rating
        - advantages
        - disadvantages
        - comment
        - createdAt
      properties:
        id:
          type: integer
          format: int64
          example: 1
        userId:
          type: integer
          format: int64
          example: 1
        userName:
          type: string
          example: "John Doe"
        rating:
          type: integer
          minimum: 1
          maximum: 5
          example: 5
        advantages:
          type: string
          example: "Great quality"
        disadvantages:
          type: string
          example: "None"
        comment:
          type: string
          example: "Excellent product!"
        createdAt:
          type: string
#          format: date-time
          example: "2023-12-01T10:00:00Z"

    GetReviewsResponse:
      type: object
      required:
        - reviews
      properties:
        reviews:
          type: array
          items:
            $ref: '#/components/schemas/ReviewInfo'

    CreateReviewRequest:
      type: object
      required:
        - itemId
        - rating
        - advantages
        - disadvantages
        - comment
      properties:
        itemId:
          type: integer
          format: int64
          example: 1
        rating:
          type: integer
          minimum: 1
          maximum: 5
          example: 5
        advantages:
          type: string
          example: "Great quality"
        disadvantages:
          type: string
          example: "None"
        comment:
          type: string
          example: "Excellent product!"

    CreateReviewResponse:
      type: object
      required:
        - reviewId
      properties:
        reviewId:
          type: integer
          format: int64
          example: 123

    CategoryInfo:
      type: object
      required:
        - id
        - name
      nullable: true
      properties:
        id:
          type: integer
          format: int64
          example: 1
        name:
          type: string
          example: "Electronics"

    GetCategoryResponse:
      type: object
      required:
        - id
        - name
        - children
      properties:
        id:
          type: integer
          format: int64
          example: 1
        name:
          type: string
          example: "Electronics"
        parent:
          $ref: '#/components/schemas/CategoryInfo'
        children:
          type: array
          items:
            $ref: '#/components/schemas/CategoryInfo'

    GetItemsByCategoryResponse:
      type: object
      required:
        - items
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/ItemInfo'

    ItemsFetchResponse:
      type: object
      required:
        - productCards
      properties:
        productCards:
          type: array
          items:
            $ref: '#/components/schemas/ItemCard'

tags:
  - name: Authentication
    description: Авторизация
  - name: User
    description: Профиль пользователя
  - name: Items
    description: Товары
  - name: Cart
    description: Корзина
  - name: Orders
    description: Заказы
  - name: Reviews
    description: Отзывы
  - name: Categories
    description: Категории
  - name: Seller
    description: Действия продавца
